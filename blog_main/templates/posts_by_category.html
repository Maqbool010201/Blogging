{% extends 'base/base.html' %}
{% load static %}
{% load ads_tags %}  <!-- Add this line -->

{% block extra_css %}
<style>
    /* Your existing CSS styles remain the same */
    :root {
        --primary-blue: #2563eb;
        --blue-hover: #1d4ed8;
        --accent-color: #f43f5e;
        --header-gradient: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* ... rest of your existing CSS ... */
    
    /* Add ad container styles */
    .ad-container {
        border: 1px solid #e9ecef;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 2rem;
    }
    
    .ad-label {
        background: #6c757d;
        color: white;
        text-align: center;
        padding: 0.25rem;
        font-size: 0.75rem;
        font-weight: 500;
    }
    
    .ad-unit {
        min-height: 100px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        background: #f8f9fa;
    }
</style>
{% endblock %}

{% block content %}
    <!-- Category Header Section -->
    <section class="container category-posts-section">
        <div class="category-header">
            <div class="category-header-content">
                <div class="category-icon-large">
                    <i class="fas fa-folder"></i>
                </div>
                <h1 class="display-5 fw-bold">{{ category.category_name }}</h1>
                <p class="lead mb-0">{{ posts|length }} article{% if posts|length != 1 %}s{% endif %} in this category</p>
                
                <div class="category-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ posts|length }}</div>
                        <div class="stat-label">Articles</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ categories|length }}</div>
                        <div class="stat-label">Categories</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-lg-8">
                <!-- Top Ad with category targeting -->
                <div class="ad-container">
                    <div class="ad-label">Advertisement</div>
                    <div class="ad-unit">{% show_ad 'CONTENT_TOP' category.id %}</div>
                </div>
                
                {% if posts %}
                    <div class="post-list">
                        {% for post in posts %}
                        <div class="post-list-item">
                            <div class="post-meta-small">
                                <span class="post-date"><i class="far fa-calendar me-1"></i> {{ post.created_at|timesince }} ago</span>
                                <span class="post-author"><i class="fas fa-user me-1"></i> {{ post.author.username }}</span>
                            </div>
                            <a href="{% url 'blog_detail' post.slug %}" class="post-title">{{ post.title }}</a>
                            <p class="post-excerpt">{{ post.short_description|truncatewords:20 }}</p>
                            <a href="{% url 'blog_detail' post.slug %}" class="read-more-link">
                                Read More <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>

                        <!-- Middle Ad after every 2 posts -->
                        {% if forloop.counter|divisibleby:2 and not forloop.last %}
                        <div class="ad-container">
                            <div class="ad-label">Sponsored Content</div>
                            <div class="ad-unit">{% show_ad 'CONTENT_MIDDLE' category.id %}</div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>

                    <!-- Bottom Ad -->
                    <div class="ad-container">
                        <div class="ad-label">Advertisement</div>
                        <div class="ad-unit">{% show_ad 'CONTENT_BOTTOM' category.id %}</div>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-folder-open"></i>
                        </div>
                        <h3>No articles found</h3>
                        <p class="mb-4">There are no articles in this category yet.</p>
                        <a href="{% url 'home' %}" class="btn btn-primary mt-3">Back to Home</a>
                    </div>
                {% endif %}
            </div>
            
            <div class="col-lg-4">
                <!-- Sidebar Top Ad with category targeting -->
                <div class="ad-container">
                    <div class="ad-label">Advertisement</div>
                    <div class="ad-unit">{% show_ad 'SIDEBAR_TOP' category.id %}</div>
                </div>

                <div class="category-sidebar">
                    <h4 class="sidebar-title">About This Category</h4>
                    <p class="mb-4">Explore all articles related to {{ category.category_name }}. This category contains {{ posts|length }} published article{% if posts|length != 1 %}s{% endif %}.</p>
                    
                    <h5 class="sidebar-title">Popular Categories</h5>
                    <ul class="category-list">
                        {% for cat in categories|slice:":6" %}
                        <li class="category-list-item">
                            <a href="{% url 'posts_by_category' cat.id %}" class="category-link">
                                {{ cat.category_name }}
                                <span class="post-count-badge">{{ cat.post_count }}</span>
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Sidebar Bottom Ad with category targeting -->
                <div class="ad-container">
                    <div class="ad-label">Advertisement</div>
                    <div class="ad-unit">{% show_ad 'SIDEBAR_BOTTOM' category.id %}</div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block extra_js %}
<script>
    // Your existing JavaScript remains the same
    document.addEventListener('DOMContentLoaded', function() {
        const postItems = document.querySelectorAll('.post-list-item');
        postItems.forEach((item, index) => {
            item.style.opacity = '0';
            item.style.transform = 'translateY(20px)';
            item.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            
            setTimeout(() => {
                item.style.opacity = '1';
                item.style.transform = 'translateY(0)';
            }, 100 + (index * 100));
        });
        
        const sidebar = document.querySelector('.category-sidebar');
        if (sidebar) {
            sidebar.style.opacity = '0';
            sidebar.style.transform = 'translateX(20px)';
            sidebar.style.transition = 'opacity 0.5s ease 0.3s, transform 0.5s ease 0.3s';
            
            setTimeout(() => {
                sidebar.style.opacity = '1';
                sidebar.style.transform = 'translateX(0)';
            }, 400);
        }
    });
</script>
{% endblock %}